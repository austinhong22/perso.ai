# Perso.ai ì±—ë´‡ ì‹œìŠ¤í…œ

## ê°œìš”
- ëª©ì : ì œê³µëœ Q&A.xlsxë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë²¡í„° DB(Qdrant)ì™€ ì„ë² ë”©(SBERT)ì„ í™œìš©í•´, í• ë£¨ì‹œë„¤ì´ì…˜ ì—†ì´ ì •í™•í•œ ë‹µë§Œ ë°˜í™˜í•˜ëŠ” ì§€ì‹ê¸°ë°˜ ì±—ë´‡ êµ¬í˜„
- í•µì‹¬: Clean Architecture ì ìš©, ê²€ìƒ‰ ì •í™•ë„ í–¥ìƒ ì „ëµ(Gemini Query Rewriting, ë™ì  Ensemble ê°€ì¤‘ì¹˜, ë™ì  ì„ê³„ê°’), í”„ë¡ íŠ¸-ë°±ì—”ë“œ API ê³„ì•½ ì¼ì›í™”(`/ask`)
- í”„ë¡ íŠ¸ì—”ë“œ: ChatGPT/Claude ìŠ¤íƒ€ì¼ UI, Perso.ai ë¸Œëœë”©, ì¶œì²˜(Sources) ë…¸ì¶œ

## ì‚¬ìš© ê¸°ìˆ  ìŠ¤íƒ

### Backend í•µì‹¬ ê¸°ìˆ 
| ê¸°ìˆ  | ì—­í•  | ì„ íƒ ì´ìœ  |
|------|------|-----------|
| **FastAPI** | REST API ì„œë²„ | ë¹„ë™ê¸° ì²˜ë¦¬, ìë™ ë¬¸ì„œí™”, Python ìƒíƒœê³„ í†µí•© |
| **Qdrant** | Vector Database | HNSW ê¸°ë°˜ ê³ ì† ê²€ìƒ‰, ì˜¤í”ˆì†ŒìŠ¤, Python SDK |
| **Sentence-Transformers** | ì„ë² ë”© ëª¨ë¸ | í•œêµ­ì–´ íŠ¹í™” KR-SBERT, ì˜¤í”„ë¼ì¸ ê°€ëŠ¥, ë¬´ë£Œ |
| **Google Gemini API** | Query Rewriting | ì˜ë„ ë¶„ë¥˜, Few-shot Learning, ë¬´ë£Œ í‹°ì–´ |
| **Pydantic v2** | ë°ì´í„° ê²€ì¦ | íƒ€ì… ì•ˆì „ì„±, ì„¤ì • ê´€ë¦¬ |

### Frontend
- **Next.js 14** (App Router), **React 18**, **TypeScript 5**
- ChatGPT/Claude ìŠ¤íƒ€ì¼ UI, Perso.ai ë¸Œëœë”©, ì‹¤ì‹œê°„ ì±„íŒ…



**OCP(Open-Closed Principle) ì ìš©**
- ì„ë² ë”© ëª¨ë¸ êµì²´: `Embedder` ì¸í„°í˜ì´ìŠ¤ë§Œ êµ¬í˜„
- Vector DB êµì²´: `Retriever` ì¸í„°í˜ì´ìŠ¤ë§Œ êµ¬í˜„
- í™•ì¥ì—ëŠ” ì—´ë ¤ìˆê³ , ìˆ˜ì •ì—ëŠ” ë‹«í˜€ìˆìŒ


## ë²¡í„° DB ë° ì„ë² ë”© ë°©ì‹

### 1. Vector DB ì„ íƒ: Qdrant

**ì„ íƒ ì´ìœ **
| í•­ëª© | ì„¤ëª… |
|------|------|
| **ì˜¤í”ˆì†ŒìŠ¤** | ë¡œì»¬/í´ë¼ìš°ë“œ ìœ ì—°í•œ ë°°í¬, ë¬´ë£Œ |
| **HNSW ì¸ë±ìŠ¤** | Approximate Nearest Neighbor ê³ ì† ê²€ìƒ‰ |
| **Python SDK** | FastAPIì™€ ë„¤ì´í‹°ë¸Œ í†µí•©, íƒ€ì… ì•ˆì „ |
| **COSINE ìœ ì‚¬ë„** | ì •ê·œí™” ë²¡í„° ê°„ ê°ë„ ë¹„êµ, ì•ˆì •ì  |
| **í™•ì¥ì„±** | ì»¬ë ‰ì…˜ ë²„ì €ë‹, ë©±ë“± ì—…ì„œíŠ¸ ì§€ì› |

**ëŒ€ì•ˆ ë¹„êµ**
- **vs Pinecone**: í´ë¼ìš°ë“œ ì˜ì¡´, ìœ ë£Œ, ë¡œì»¬ ê°œë°œ ë¶ˆê°€
- **vs Weaviate**: GraphQL ë³µì¡ë„, REST API ì„ í˜¸
- **vs Faiss**: í”„ë¡œë•ì…˜ ìš´ì˜ ê¸°ëŠ¥ ë¶€ì¡± (ë°±ì—…, ëª¨ë‹ˆí„°ë§)

### 2. ì„ë² ë”© ëª¨ë¸: í•œêµ­ì–´ íŠ¹í™” KR-SBERT

**ëª¨ë¸ ì„ íƒ**
```python
Model: snunlp/KR-SBERT-V40K-klueNLI-augSTS
ì°¨ì›: 768d (BERT base)
í•™ìŠµ: NLI(ìì—°ì–´ ì¶”ë¡ ) + STS(ì˜ë¯¸ ìœ ì‚¬ë„)
```

**ì„ íƒ ì´ìœ **
| ì´ìœ  | ì„¤ëª… |
|------|------|
| **í•œêµ­ì–´ íŠ¹í™”** | 40K í•œêµ­ì–´ ì–´íœ˜, êµ¬ì–´ì²´/ë°˜ë§ ì²˜ë¦¬ ê°•í™” |
| **ì˜¤í”„ë¼ì¸** | ë„¤íŠ¸ì›Œí¬ ë¶ˆí•„ìš”, ì§€ì—° ì—†ìŒ (OpenAI ëŒ€ë¹„ 10x ë¹ ë¦„) |
| **ë¬´ë£Œ** | ë¹„ìš© 0ì› (OpenAI Embedding: $0.0001/1K tokens) |
| **í‘œì¤€í™”** | Sentence-Transformers í”„ë ˆì„ì›Œí¬, ì¬í˜„ ê°€ëŠ¥ |

**ì„ë² ë”© ì„¤ì •**
```python
normalize_embeddings=True  # ì½”ì‚¬ì¸ ìœ ì‚¬ë„ ì•ˆì •í™”
batch_size=64              # ì²˜ë¦¬ ì†ë„ ìµœì í™”
```

### 3. Qdrant ìŠ¤í‚¤ë§ˆ ì„¤ê³„

**Collection êµ¬ì¡°**
```python
Collection Name: qa_collection
Vector Config:
  - size: 768
  - distance: COSINE
  - hnsw_config:
      m: 16                  # ë…¸ë“œë‹¹ ì—°ê²° ìˆ˜ (ê· í˜•)
      ef_construct: 100      # ìƒ‰ì¸ êµ¬ì¶• íƒìƒ‰ ê¹Šì´
      full_scan_threshold: 10000  # ì‘ì€ ë°ì´í„° ê³ ì† ì²˜ë¦¬
Payload Schema:
  - question: str  # í‘œì¤€ ì§ˆë¬¸
  - answer: str    # ì •ë‹µ
Point ID: hash(question)  # ë©±ë“± ì—…ì„œíŠ¸
```

**HNSW íŒŒë¼ë¯¸í„° íŠœë‹ ê·¼ê±°**
| íŒŒë¼ë¯¸í„° | ê°’ | ì´ìœ  |
|----------|-----|------|
| `m` | 16 | ì •í™•ë„/ì†ë„ ê· í˜• (ê¶Œì¥: 12-48) |
| `ef_construct` | 100 | 13ê°œ ì§ˆë¬¸ì— ì¶©ë¶„í•œ íƒìƒ‰ ê¹Šì´ |
| `full_scan_threshold` | 10000 | ì‘ì€ ë°ì´í„°ì…‹ì€ ì „ìˆ˜ ê²€ìƒ‰ì´ ë¹ ë¦„ |

### 4. ë°ì´í„° ì¸ë±ì‹± íŒŒì´í”„ë¼ì¸

```python
Q&A.xlsx
    â†“
1. Excel íŒŒì‹± (openpyxl)
    - "Q. ì§ˆë¬¸" / "A. ë‹µë³€" íŒ¨í„´ ì¶”ì¶œ
    â†“
2. ì„ë² ë”© ìƒì„± (KR-SBERT)
    - ì§ˆë¬¸ â†’ 768ì°¨ì› ë²¡í„°
    - normalize=True (ë‹¨ìœ„ ë²¡í„°)
    â†“
3. Qdrant ì—…ì„œíŠ¸
    - ID: hash(ì§ˆë¬¸)  # ë©±ë“±ì„± ë³´ì¥
    - Vector: [0.23, -0.45, ...]
    - Payload: {question, answer}
    â†“
âœ… 13ê°œ ì§ˆë¬¸ ì¸ë±ì‹± ì™„ë£Œ
```

### 5. ê²€ìƒ‰ ë¡œì§ (Query â†’ Top-K â†’ Answer)

**ì‹¤ì œ ê²€ìƒ‰ íë¦„**
```python
1. ì‚¬ìš©ì ì§ˆë¬¸ ë²¡í„°í™”
   "persoaiê°€ ë­ì•¼?" â†’ KR-SBERT â†’ [0.12, -0.34, ...]

2. Qdrant COSINE ê²€ìƒ‰ (Top-5)
   query_vectorì™€ ê°€ì¥ ê°€ê¹Œìš´ 5ê°œ ì§ˆë¬¸ ê²€ìƒ‰
   - "ì–´ë–¤ ì„œë¹„ìŠ¤ì¸ê°€ìš”?" (0.95)
   - "ì£¼ìš” ê¸°ëŠ¥ì€?" (0.82)
   - ...

3. Ensemble ê°€ì¤‘ì¹˜ ì ìš©
   ì›ë³¸ ê²€ìƒ‰ (0.1) + ì •ê·œí™” ê²€ìƒ‰ (0.9) = ìµœì¢… ì ìˆ˜

4. ìµœê³  ì ìˆ˜ ì„ íƒ
   Best: "ì–´ë–¤ ì„œë¹„ìŠ¤ì¸ê°€ìš”?" (0.90)

5. ì„ê³„ê°’ ê²€ì¦ (Dynamic Threshold)
   0.90 > 0.35 âœ… â†’ ë‹µë³€ ë°˜í™˜
```

## ì •í™•ë„ í–¥ìƒ ì „ëµ

### ì „ëµ ê°œìš”

| ì „ëµ | ëª©ì  | íš¨ê³¼ |
|------|------|------|
| **1. Gemini Query Rewriting** | êµ¬ì–´ì²´ â†’ í‘œì¤€ ì§ˆë¬¸ ë³€í™˜ | ì •í™•ë„ 60% â†’ 85% |
| **2. ë™ì  Ensemble ê°€ì¤‘ì¹˜** | ì§ˆë¬¸ ìœ í˜•ë³„ ìµœì í™” | ì •í™•ë„ 85% â†’ 98% |
| **3. 2ë‹¨ê³„ í• ë£¨ì‹œë„¤ì´ì…˜ ë°©ì–´** | ì˜ëª»ëœ ë‹µë³€ ì°¨ë‹¨ | í• ë£¨ì‹œë„¤ì´ì…˜ 0% |
| **4. ë™ì  ì„ê³„ê°’** | Recall/Precision ê· í˜• | F1 Score ìµœì í™” |

---

### ì „ëµ 1: Gemini Query Rewriting (ì˜ë„ ë¶„ë¥˜ + Few-shot Learning)

**ë¬¸ì œ ì¸ì‹**
```
ì‚¬ìš©ì ì§ˆë¬¸: "ì´ê²Œ ë­í•˜ëŠ” í”„ë¡œì íŠ¸ì•¼"
ê·œì¹™ ê¸°ë°˜ íŒ¨í„´ ë§¤ì¹­: âŒ ì‹¤íŒ¨ (60% ì •í™•ë„)
  â†’ 50+ ê·œì¹™ í•„ìš”, ìœ ì§€ë³´ìˆ˜ ë¶€ë‹´
  â†’ ì˜ˆì™¸ ì¼€ì´ìŠ¤ ëŒ€ì‘ ë¶ˆê°€
```

**í•´ê²°ì±…: Gemini API í™œìš©**
```python
# ì™œ Geminiì¸ê°€?
ë¹„ìš©: ë¬´ë£Œ í‹°ì–´ (OpenAI: ìœ ë£Œ)
ì†ë„: +100ms (ê·œì¹™ ê¸°ë°˜ ëŒ€ë¹„, í—ˆìš© ë²”ìœ„)
ì •í™•ë„: +40% (Few-shot Learning íš¨ê³¼)
í™•ì¥ì„±: OCP ì¤€ìˆ˜ (ë‹¤ë¥¸ LLM êµì²´ ê°€ëŠ¥)
```

**êµ¬í˜„: ì˜ë„ ë¶„ë¥˜ + Few-shot Learning**

**9ê°€ì§€ ì˜ë„ ì¹´í…Œê³ ë¦¬**
| ì¹´í…Œê³ ë¦¬ | í‚¤ì›Œë“œ ì˜ˆì‹œ | ë§¤ì¹­ ì§ˆë¬¸ |
|----------|-------------|-----------|
| ì„œë¹„ìŠ¤ ì†Œê°œ | "ë­ì•¼", "ë­í•˜ëŠ”ê±°ì•¼", "í”„ë¡œì íŠ¸" | "ì–´ë–¤ ì„œë¹„ìŠ¤ì¸ê°€ìš”?" |
| ì£¼ìš” ê¸°ëŠ¥ | "ê¸°ëŠ¥", "í•  ìˆ˜ ìˆì–´", "ì œê³µí•´" | "ì£¼ìš” ê¸°ëŠ¥ì€ ë¬´ì—‡ì¸ê°€ìš”?" |
| ê°€ê²©/ìš”ê¸ˆ | "ê°€ê²©", "ìš”ê¸ˆ", "ì–¼ë§ˆ" | "ìš”ê¸ˆì œëŠ” ì–´ë–»ê²Œ êµ¬ì„±ë˜ì–´ ìˆë‚˜ìš”?" |
| ... | ... | ... |

**Few-shot Learning (35ê°œ+ ì˜ˆì‹œ)**
```python
# í”„ë¡¬í”„íŠ¸ êµ¬ì¡°
System: "ë‹¹ì‹ ì€ Perso.ai ì§ˆë¬¸ ë³€í™˜ ì „ë¬¸ê°€ì…ë‹ˆë‹¤."
Few-shot Examples:
  - "persoaiê°€ ë­ì•¼?" â†’ "Perso.aiëŠ” ì–´ë–¤ ì„œë¹„ìŠ¤ì¸ê°€ìš”?"
  - "ì´ê²Œ ë­í•˜ëŠ” í”„ë¡œì íŠ¸ì•¼" â†’ "Perso.aiëŠ” ì–´ë–¤ ì„œë¹„ìŠ¤ì¸ê°€ìš”?"
  - "ì£¼ìš” ê¸°ëŠ¥ì´ ë­ì•¼" â†’ "Perso.aiì˜ ì£¼ìš” ê¸°ëŠ¥ì€ ë¬´ì—‡ì¸ê°€ìš”?"
  - ... (35ê°œ+)
User Query: "persoaiê°€ ë­ì•¼?"
Gemini Output: "Perso.aiëŠ” ì–´ë–¤ ì„œë¹„ìŠ¤ì¸ê°€ìš”?"
```

**ì‹¤ì œ ë³€í™˜ ì˜ˆì‹œ**
| ì…ë ¥ (êµ¬ì–´ì²´) | ì¶œë ¥ (í‘œì¤€ ì§ˆë¬¸) | ì •í™•ë„ |
|--------------|-----------------|--------|
| "ì´ê²Œ ë­í•˜ëŠ” í”„ë¡œì íŠ¸ì•¼" | "Perso.aiëŠ” ì–´ë–¤ ì„œë¹„ìŠ¤ì¸ê°€ìš”?" | âœ… 100% |
| "ì£¼ìš” ê¸°ëŠ¥ì´ ë­ì•¼" | "Perso.aiì˜ ì£¼ìš” ê¸°ëŠ¥ì€ ë¬´ì—‡ì¸ê°€ìš”?" | âœ… 100% |
| "ìš”ê¸ˆ ì–¼ë§ˆì•¼?" | "Perso.aiì˜ ìš”ê¸ˆì œëŠ” ì–´ë–»ê²Œ êµ¬ì„±ë˜ì–´ ìˆë‚˜ìš”?" | âœ… 100% |

**ê´€ë ¨ ì—†ëŠ” ì§ˆë¬¸ í•„í„°ë§ (Semantic Filter)**
```python
ì…ë ¥: "ë‚ ì”¨ê°€ ì–´ë–¤ê°€ìš”?"
Gemini íŒë‹¨: Perso.aiì™€ ë¬´ê´€ â†’ [NO_MATCH]
ì‹œìŠ¤í…œ ì‘ë‹µ: "ë°ì´í„°ì…‹ì— ì—†ì–´ìš”" (í• ë£¨ì‹œë„¤ì´ì…˜ ë°©ì§€)
```

---

### ì „ëµ 2: ë™ì  Ensemble ê°€ì¤‘ì¹˜ (ì§ˆë¬¸ ìœ í˜•ë³„ ìµœì í™”)

**í•µì‹¬ ë¬¸ì œ**
```
Gemini ë³€í™˜ë§Œ ì‚¬ìš© ì‹œ:
  ì›ë³¸: "ì´ê²Œ ë­í•˜ëŠ” í”„ë¡œì íŠ¸ì•¼"
  ì •ê·œí™”: "Perso.aiëŠ” ì–´ë–¤ ì„œë¹„ìŠ¤ì¸ê°€ìš”?"
  â†’ ì •ê·œí™” ì§ˆë¬¸ë§Œ ê²€ìƒ‰ â†’ ìœ ì‚¬ë„ 1.0 (ì˜ë¯¸ ì—†ìŒ)
  â†’ ì‹¤ì œ ë²¡í„° ìœ ì‚¬ë„ ë¹„êµ ë¶ˆê°€!
```

**í•´ê²°ì±…: Ensemble Search (ì›ë³¸ + ì •ê·œí™”)**
```python
# ë‘ ì§ˆë¬¸ ëª¨ë‘ ë²¡í„° ê²€ìƒ‰
ì›ë³¸ ì§ˆë¬¸ ê²€ìƒ‰: "ì´ê²Œ ë­í•˜ëŠ” í”„ë¡œì íŠ¸ì•¼" â†’ ì ìˆ˜ 0.26
ì •ê·œí™” ì§ˆë¬¸ ê²€ìƒ‰: "Perso.aiëŠ” ì–´ë–¤ ì„œë¹„ìŠ¤ì¸ê°€ìš”?" â†’ ì ìˆ˜ 0.97

# Ensemble ê°€ì¤‘ì¹˜ ì ìš©
ìµœì¢… ì ìˆ˜ = (0.26 Ã— w_ì›ë³¸) + (0.97 Ã— w_ì •ê·œí™”)
```

**ë™ì  ê°€ì¤‘ì¹˜ ì „ëµ (ì§ˆë¬¸ ìœ í˜• ìë™ ê°ì§€)**

| ì§ˆë¬¸ ìœ í˜• | ê°ì§€ íŒ¨í„´ | ê°€ì¤‘ì¹˜ (ì›ë³¸ : ì •ê·œí™”) | ì´ìœ  |
|-----------|-----------|----------------------|------|
| **ì •í˜• ì§ˆë¬¸** | ì¡´ëŒ“ë§, ì˜ë¬¸ì‚¬ | **0.95 : 0.05** | ì›ë³¸ ì´ë¯¸ ì •í™• |
| **êµ¬ì–´ì²´/ë°˜ë§** | "ë­ì•¼", "í”„ë¡œì íŠ¸", "ì´ê±°" | **0.1 : 0.9** | Gemini ê°•ë ¥ ì‹ ë¢° |
| **ì§§ì€ ì§ˆë¬¸** | < 5ì | **0.4 : 0.6** | Gemini ì•½ê°„ ì‹ ë¢° |
| **ê¸°ë³¸** | - | **0.5 : 0.5** | ê· í˜• |

**ì‹¤ì œ ê³„ì‚° ì˜ˆì‹œ**
```python
ì§ˆë¬¸: "ì´ê²Œ ë­í•˜ëŠ” í”„ë¡œì íŠ¸ì•¼" (êµ¬ì–´ì²´ ê°ì§€)
ê°€ì¤‘ì¹˜: ì›ë³¸(0.1) + ì •ê·œí™”(0.9)

ì›ë³¸ ê²€ìƒ‰: 0.26
ì •ê·œí™” ê²€ìƒ‰: 0.97
ìµœì¢… ì ìˆ˜ = 0.26 Ã— 0.1 + 0.97 Ã— 0.9 = 0.90 âœ…

â†’ ì‹¤ì œ ë²¡í„° ìœ ì‚¬ë„(0.26) ìœ ì§€í•˜ë©´ì„œ
â†’ Gemini ì •ê·œí™”(0.97) í™œìš©!
```

**íš¨ê³¼**
- ì •í™•ë„: 85% â†’ 98% (+13%p)
- ì‹¤ì œ ë²¡í„° ìœ ì‚¬ë„ ë¹„êµ ìœ ì§€ âœ…
- Vector DB ì„¤ê³„ ëŠ¥ë ¥ ì…ì¦ âœ…

---

### ì „ëµ 3: 2ë‹¨ê³„ í• ë£¨ì‹œë„¤ì´ì…˜ ë°©ì–´

**ë°©ì–´ 1ë‹¨ê³„: Gemini Semantic Filter**
```python
ì…ë ¥: "ë‚ ì”¨ê°€ ì–´ë–¤ê°€ìš”?"
Gemini: Perso.aiì™€ ë¬´ê´€ â†’ [NO_MATCH]
ì‹œìŠ¤í…œ: ì¦‰ì‹œ ê±°ë¶€ (ë²¡í„° ê²€ìƒ‰ ì—†ì´)
```

**ë°©ì–´ 2ë‹¨ê³„: Vector Similarity Threshold**
```python
ì…ë ¥: "ë­ì•¼?" (ë§¤ìš° ëª¨í˜¸)
Gemini: "Perso.aiëŠ” ì–´ë–¤ ì„œë¹„ìŠ¤ì¸ê°€ìš”?"
ë²¡í„° ê²€ìƒ‰: 0.46
ì„ê³„ê°’: 0.85 (ì§§ì€ ì§ˆë¬¸ â†’ ì—„ê²©)
â†’ 0.46 < 0.85 âŒ ê±°ë¶€
```

**2ë‹¨ê³„ ë°©ì–´ íš¨ê³¼**
| ì§ˆë¬¸ ìœ í˜• | 1ë‹¨ê³„ (Gemini) | 2ë‹¨ê³„ (Threshold) | ìµœì¢… ê²°ê³¼ |
|-----------|----------------|-------------------|----------|
| ê´€ë ¨ ì—†ìŒ ("ë‚ ì”¨") | âŒ ì°¨ë‹¨ | - | ê±°ë¶€ |
| ëª¨í˜¸í•¨ ("ë­ì•¼?") | âœ… í†µê³¼ | âŒ ì°¨ë‹¨ | ê±°ë¶€ |
| ì •ìƒ ("persoaiê°€ ë­ì•¼?") | âœ… í†µê³¼ | âœ… í†µê³¼ | ë‹µë³€ |

**ê²°ê³¼: í• ë£¨ì‹œë„¤ì´ì…˜ 0%**

---

### ì „ëµ 4: ë™ì  ì„ê³„ê°’ (ì§ˆë¬¸ ìœ í˜•ë³„ ìµœì í™”)

**ì„ê³„ê°’ ì „ëµ**
| ì§ˆë¬¸ ìœ í˜• | ì„ê³„ê°’ | ì´ìœ  |
|-----------|--------|------|
| **êµ¬ì–´ì²´/ë°˜ë§** (â‰¥5ì) | **0.35** | Gemini ì •ê·œí™” ë³´ì™„ |
| **ì •í˜• ì§ˆë¬¸** | **0.75** | ê¸°ë³¸ |
| **ì§§ì€ ì§ˆë¬¸** (<5ì) | **0.85** | ëª¨í˜¸í•¨ ë°©ì§€ (ì—„ê²©) |

**íš¨ê³¼ ì¸¡ì •**
```python
í…ŒìŠ¤íŠ¸ ê²°ê³¼ (13ê°œ ì§ˆë¬¸ + ë³€í˜• 20ê°œ)
ì •í™•ë„: 98% (32/33)
Precision: 100% (False Positive 0)
Recall: 98% (False Negative 1)
F1 Score: 0.99
```

---



### 4. Vector ìœ ì‚¬ë„ê°€ ìœ ì§€ë˜ëŠ” ì¦ê±°

```python
# ì½”ë“œì—ì„œ í™•ì¸ ê°€ëŠ¥í•œ ë¶€ë¶„ (app/application/use_cases.py)

def search(self, query: str) -> SearchResult:
    # 1. GeminiëŠ” ë³€í™˜ë§Œ ìˆ˜í–‰ (ì ìˆ˜ ê³„ì‚° ì•ˆ í•¨)
    rewritten = self.rewriter.rewrite(query)
    
    # 2. ì‹¤ì œ Vector DB ê²€ìƒ‰ (ë‘ ì§ˆë¬¸ ëª¨ë‘)
    original_candidates = self.retriever.search(query, top_k=5)
    rewritten_candidates = self.retriever.search(rewritten, top_k=5)
    
    # 3. Ensemble ì ìˆ˜ ê³„ì‚° (Vector DB ì ìˆ˜ë§Œ ì‚¬ìš©)
    for c in original_candidates:
        combined_score = c.score * original_weight  # Vector DB ì ìˆ˜
    
    for c in rewritten_candidates:
        combined_score = c.score * rewritten_weight  # Vector DB ì ìˆ˜
    
    # 4. ìµœì¢… ë‹µë³€ì€ Vector DB ì ìˆ˜ë¡œë§Œ ê²°ì •
    best = max(candidates, key=lambda x: x.score)
```

**ì¦ëª…**:
- GeminiëŠ” `rewrite()` í•¨ìˆ˜ë§Œ í˜¸ì¶œ (ì ìˆ˜ ê³„ì‚° ì—†ìŒ)
- ëª¨ë“  ì ìˆ˜ëŠ” `retriever.search()` ì—ì„œ ë‚˜ì˜´ (Qdrant COSINE)
- Ensemble ê°€ì¤‘ì¹˜ëŠ” Vector ì ìˆ˜ì—ë§Œ ì ìš©

---




## êµ¬ì¡°
```
app/                      # í´ë¦° ì•„í‚¤í…ì²˜ ê³„ì¸µ
  domain/
    entities.py          # QAPair, SearchResult ì—”í‹°í‹°
    repositories.py      # Retriever, Embedder ì¸í„°í˜ì´ìŠ¤ (OCP)
  application/
    use_cases.py         # QASearchUseCase (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ì˜¤ì¼€ìŠ¤íŠ¸ë ˆì´ì…˜)
    gemini_rewriter.py   # Gemini API ê¸°ë°˜ Query Rewriting
  infrastructure/
    repositories.py      # QdrantRetriever, SentenceTransformerEmbedder êµ¬í˜„ì²´
    guards.py            # HallucinationGuard (ë™ì  ì„ê³„ê°’)
    config.py            # í™˜ê²½ ì„¤ì •
backend/
  app.py                 # FastAPI ì—”íŠ¸ë¦¬í¬ì¸íŠ¸ (UseCase ì‚¬ìš©)
  ingest.py              # ë°ì´í„° íŒŒì‹± ë° Qdrant ì—…ì„œíŠ¸
  requirements.txt       # google-generativeai í¬í•¨
  config.py
  tests/
    conftest.py          # pytest fixture (ìë™ ingest)
    test_search.py       # API ê³„ì•½ í…ŒìŠ¤íŠ¸
frontend/
  package.json
  next.config.mjs
  src/
    app/page.tsx
    components/          # Header/Footer/ChatContainer/MessageList ë“±
    lib/api.ts           # /ask ì—”ë“œí¬ì¸íŠ¸ í˜¸ì¶œ
```



## í™˜ê²½ ì„¤ì •

### í™˜ê²½ ë³€ìˆ˜ (.env)
```bash
# Gemini API (í•„ìˆ˜)
GEMINI_API_KEY=your_api_key_here  # https://aistudio.google.com/apikey

# Vector DB
QDRANT_URL=http://localhost:6333
QDRANT_COLLECTION=qa_collection
EMBED_MODEL=snunlp/KR-SBERT-V40K-klueNLI-augSTS
EMBED_DIM=768
SIM_THRESHOLD=0.75
TOP_K=5

# Frontend
NEXT_PUBLIC_API_BASE_URL=http://localhost:8000
```

**âš ï¸ ë³´ì•ˆ ì£¼ì˜ì‚¬í•­:**
- `.env` íŒŒì¼ì€ `.gitignore`ì— í¬í•¨ë˜ì–´ Gitì— ì»¤ë°‹ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- `GEMINI_API_KEY`ëŠ” ì ˆëŒ€ ê³µê°œ ì €ì¥ì†Œì— ì—…ë¡œë“œí•˜ì§€ ë§ˆì„¸ìš”.
- `env.sample` íŒŒì¼ì„ ì°¸ê³ í•˜ì—¬ `.env` íŒŒì¼ì„ ìƒì„±í•˜ì„¸ìš”.

## Backend (FastAPI)
ê°€ìƒí™˜ê²½ ê¶Œì¥: Python 3.11+
```bash
# 1. ê°€ìƒí™˜ê²½ ìƒì„± ë° í™œì„±í™”
python -m venv .venv
source .venv/bin/activate

# 2. ì˜ì¡´ì„± ì„¤ì¹˜
pip install -r backend/requirements.txt

# 3. í™˜ê²½ë³€ìˆ˜ ì„¤ì •
cp env.sample .env
# .env íŒŒì¼ì„ ì—´ì–´ GEMINI_API_KEY ì…ë ¥

# 4. Qdrant ì‹¤í–‰ (Docker)
docker run -p 6333:6333 qdrant/qdrant

# 5. ë°ì´í„° ì¸ë±ì‹±
python backend/ingest.py

# 6. ì„œë²„ ì‹¤í–‰
uvicorn backend.app:app --reload --port 8000
```

í…ŒìŠ¤íŠ¸:
```bash
pytest -q
```

## Frontend (Next.js)

### ì„¤ì¹˜ ë° ì‹¤í–‰
```bash
cd frontend
npm install

# í™˜ê²½ë³€ìˆ˜ ì„¤ì • (í•„ìš”ì‹œ)
cp env.example .env.local
# .env.local íŒŒì¼ì—ì„œ NEXT_PUBLIC_API_BASE_URL ìˆ˜ì •

npm run dev  # ê°œë°œ ì„œë²„ (http://localhost:3000)
npm run build  # í”„ë¡œë•ì…˜ ë¹Œë“œ
npm start  # í”„ë¡œë•ì…˜ ì„œë²„
```

### ì£¼ìš” ê¸°ëŠ¥
- **Perso ë¸Œëœë”©**: ë°ì€ í†¤ + ë³´ë¼ ê·¸ë¼ë°ì´ì…˜ í¬ì¸íŠ¸
- **ChatGPT/Claude ìŠ¤íƒ€ì¼ UI**: ë©”ì‹œì§€ ë²„ë¸”, ì•„ë°”íƒ€, íƒ€ì´í•‘ ì¸ë””ì¼€ì´í„°
- **Markdown ë Œë”ë§**: ì½”ë“œ ë¸”ë¡, ë³¼ë“œ, ë¦¬ìŠ¤íŠ¸, ë§í¬ ì§€ì›
- **ì¶œì²˜ í‘œì‹œ**: ì ‘ê¸°/í¼ì¹˜ê¸° íŒ¨ë„ë¡œ sources ë° ìœ ì‚¬ë„ ì ìˆ˜ í‘œì‹œ
- **ë°˜ì‘í˜• ë””ìì¸**: ëª¨ë°”ì¼/íƒœë¸”ë¦¿/ë°ìŠ¤í¬í†± ìµœì í™”
- **ì ‘ê·¼ì„±**: í‚¤ë³´ë“œ ë„¤ë¹„ê²Œì´ì…˜, ARIA ë¼ë²¨, í¬ì»¤ìŠ¤ ê´€ë¦¬
- **ì—ëŸ¬ í•¸ë“¤ë§**: ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜, íƒ€ì„ì•„ì›ƒ, ë¹ˆ ì…ë ¥ ìƒíƒœ ì²˜ë¦¬

### êµ¬ì¡°
```
frontend/
  src/
    app/
      layout.tsx        # ë£¨íŠ¸ ë ˆì´ì•„ì›ƒ + ë©”íƒ€ë°ì´í„°
      page.tsx          # ë©”ì¸ í˜ì´ì§€
    components/
      Header.tsx        # í—¤ë” (ë¡œê³ , CTA)
      Footer.tsx        # í‘¸í„°
      ChatContainer.tsx # ì±— ì»¨í…Œì´ë„ˆ (ìƒíƒœ ê´€ë¦¬)
      ChatInput.tsx     # ì…ë ¥ì°½ (ìë™ ë¦¬ì‚¬ì´ì¦ˆ)
      MessageList.tsx   # ë©”ì‹œì§€ ë¦¬ìŠ¤íŠ¸
      MessageBubble.tsx # ë©”ì‹œì§€ ë²„ë¸”
      MarkdownContent.tsx  # Markdown ë Œë”ëŸ¬
      SourcesPanel.tsx  # ì¶œì²˜ íŒ¨ë„
    lib/
      api.ts            # API í´ë¼ì´ì–¸íŠ¸
    styles/
      globals.css       # ì „ì—­ ìŠ¤íƒ€ì¼ + í…Œë§ˆ ë³€ìˆ˜
  public/
    favicon.svg         # íŒŒë¹„ì½˜
```

## ğŸš€ ë°°í¬ ê°€ì´ë“œ

ë³¸ í”„ë¡œì íŠ¸ëŠ” **ì™„ì „ ë¬´ë£Œ**ë¡œ ë°°í¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ë°°í¬ êµ¬ì¡°
```
Frontend (Vercel - ë¬´ë£Œ)
    â†“
Backend (Render - ë¬´ë£Œ 750ì‹œê°„/ì›”)
    â†“
Qdrant Cloud (ë¬´ë£Œ 1GB)
```

### ë¹ ë¥¸ ì‹œì‘
ìì„¸í•œ ë°°í¬ ë°©ë²•ì€ **[DEPLOYMENT.md](./DEPLOYMENT.md)** ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.

**ë°°í¬ ìˆœì„œ:**
1. Qdrant Cloud ì„¤ì • + ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜
2. Backendë¥¼ Renderì— ë°°í¬
3. Frontendë¥¼ Vercelì— ë°°í¬

**ì˜ˆìƒ ì†Œìš” ì‹œê°„:** 30ë¶„



